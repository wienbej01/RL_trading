# Repository Guidelines

## Project Structure & Modules
- `src/`: Production code organized by domain (`data/`, `features/`, `rl/`, `sim/`, `trading/`, `evaluation/`, `monitoring/`, `utils/`).
- `tests/`: Pytest suite with unit/integration tests and benchmarks.
- `scripts/`: CLI utilities (data collection, reports, pipelines, test runners).
- `configs/`: YAML settings for env, risk, execution, and training.
- `data/`, `results/`, `runs/`, `models/`, `logs/`, `reports/`: Local artifacts; not all are checked in.
- `docs/`: Project notes and documentation.

## Build, Test, and Dev Commands
- Install deps: `pip install -r requirements.txt && pip install -e .[dev]`
- Format: `black .`  | Lint: `ruff check . --fix`
- Type-check: `mypy src scripts tests`
- Run tests (default): `pytest -m "not slow"`
- Specific markers: `pytest -m unit`, `pytest -m integration`, `pytest -m "not slow and not integration"`
- Coverage reports: open `htmlcov/index.html` (generated via pytest config).
- Train locally (example):
  `python -m src.rl.train --config configs/settings.yaml --data data/raw/SPY_1m.parquet --features data/features/SPY_features.parquet --ticker SPY --total-steps 100000`
- Walk-forward/backtest (example):
  `python scripts/walkforward_train_eval.py --config configs/settings.yaml --data data/raw/SPY_1m.parquet --features data/features/SPY_features.parquet --output runs/wf_spy`

## Coding Style & Naming
- Python 3.11+, Black line length 100; run `black .` before pushing.
- Ruff rules enabled; prefer automatic fixes: `ruff check . --fix`.
- Mypy strictness enabled; add type hints and avoid `Any` where possible.
- Naming: modules/functions `snake_case`, classes `PascalCase`, constants `UPPER_SNAKE_CASE`.

## Testing Guidelines
- Framework: Pytest. Tests live in `tests/` and follow `test_*.py`, `Test*`, `test_*`.
- Markers: `unit`, `integration`, `slow`, `data`, `ibkr`. Use markers to scope runtime.
- Aim for meaningful coverage and keep `src/` covered; coverage HTML/XML generated by pytest config.
- Provide minimal fixtures/sample data; avoid external calls unless marked and skipped by default.

## Commit & Pull Requests
- Use Conventional Commits: `feat(scope): ...`, `fix(scope): ...`, `chore: ...`.
- PRs should include: problem statement, summary of changes, before/after notes (plots/screens ok), test updates, and linked issues.
- All checks must pass locally: `ruff`, `black`, `mypy`, `pytest`.

## Security & Configuration
- Place secrets in `.env` (gitignored). Common keys: `POLYGON_API_KEY`, IBKR creds, etc.
- Prefer config-driven changes via `configs/*.yaml`; avoid hardcoded absolute paths.
